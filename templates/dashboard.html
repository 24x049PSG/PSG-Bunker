<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - PSG Bunker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Favicon Implementation -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="PSG Bunker Dashboard - View your attendance and CGPA">
    <meta name="keywords" content="PSG Tech dashboard, student attendance, CGPA tracker">
    <meta name="author" content="Manu Sanjay">


    
</head>
<body>
    <div class="container">
        <h1>ðŸ“š PSG Bunker Dashboard</h1>

        <div class="card">
            <div class="card-header">Welcome, {{ rollno }} | PSG College of Technology</div>
        </div>

        <!-- CGPA Section moved to top -->
        <h2>ðŸŽ“ Academic Performance</h2>
        <div class="grid grid-3">
            <div class="stat-card">
                <span class="stat-number">{{ cgpa.total_cgpa or '0.0' }}</span>
                <div class="stat-label">Total CGPA</div>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ cgpa.latest_sem or '-' }}</span>
                <div class="stat-label">Latest Semester</div>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ cgpa.total_semesters or '0' }}</span>
                <div class="stat-label">Semesters Completed</div>
            </div>
        </div>

        <!-- Subject-wise Attendance Section -->
        <h2>ðŸ“š Subject-wise Attendance</h2>
        <div id="attendanceContainer">
            <div class="loading"></div>
            <p>Loading attendance data...</p>
        </div>

        <!-- Share Section -->
        <div class="share-section text-center">
            <button class="share-btn" onclick="shareApp()">
                ðŸ“¤ Share PSG Bunker
            </button>
        </div>

        <!-- Developer Credit and Instagram Link at Bottom -->
        <div style="text-align: center; margin-top: 2rem; padding: 1rem 0; border-top: 1px solid #333; color: #888;">
            <div style="margin-bottom: 0.5rem; font-size: 0.9rem;">
                Website developed by Manu Sanjay Btech-IT PSG TECH
            </div>
            <a href="https://www.instagram.com/manu_sanjay.m" target="_blank" style="color: #4a9eff; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; justify-content: center;">
                <img src="https://img.icons8.com/?size=100&id=BrU2BBoRXiWq&format=png&color=4a9eff" alt="Instagram" style="width: 20px; height: 20px;">
                @manu_sanjay.m
            </a>
        </div>
    </div>

    <script>
        // Load attendance data
        fetch('/attendance')
            .then(response => response.json())
            .then(data => {
                displayAttendance(data);
            })
            .catch(error => {
                console.error('Error loading attendance:', error);
                document.getElementById('attendanceContainer').innerHTML = 
                    '<div class="alert alert-danger">Error loading attendance data</div>';
            });

        function displayAttendance(data) {
            const container = document.getElementById('attendanceContainer');

            if (data.error) {
                container.innerHTML = '<div class="alert alert-danger">' + data.error + '</div>';
                return;
            }

            let html = '';

            // REMOVED: Overall stats section (Total Classes, Attended, Overall %, Must Attend/Can Miss)
            // Now directly showing individual subject cards

            // Subject cards (without subject type display)
            data.subjects.forEach(subject => {
                const statusClass = subject.percentage_of_attendance >= 75 ? 'success' : 'danger';
                const percentageClass = getPercentageClass(subject.percentage_of_attendance);

                html += `
                    <div class="subject-card ${statusClass}">
                        <div class="subject-title">${subject.display_name || subject.name}</div>

                        <div class="subject-main-info">
                            <div class="attendance-percentage">
                                <span class="percentage-number ${percentageClass}">${subject.percentage_of_attendance.toFixed(1)}%</span>
                                <div class="attendance-details">
                                    ${subject.total_present}/${subject.total_hours} classes attended
                                </div>
                            </div>

                            <div class="status-display">
                                <span class="status-number ${subject.classes_to_attend > 0 ? 'status-must-attend' : 'status-can-miss'}">
                                    ${subject.classes_to_attend > 0 ? subject.classes_to_attend : subject.classes_to_bunk}
                                </span>
                                <div class="status-label ${subject.classes_to_attend > 0 ? 'status-must-attend' : 'status-can-miss'}">
                                    ${subject.classes_to_attend > 0 ? 'Must Attend' : 'Can Miss'}
                                </div>
                            </div>
                        </div>

                        <div class="subject-footer">
                            <div><strong>Period:</strong> ${subject.attendance_from} to ${subject.attendance_to}</div>
                            <div><strong>Total Hours:</strong> ${subject.total_hours} | <strong>Exception:</strong> ${subject.exception_hour}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function getPercentageClass(percentage) {
            if (percentage >= 85) return 'success';
            if (percentage >= 75) return 'warning';
            return 'danger';
        }

        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: 'PSG Bunker - Attendance Tracker',
                    text: 'Check out PSG Bunker - Easy attendance and CGPA tracking for PSG Tech students!',
                    url: window.location.origin
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                const url = window.location.origin;
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(url).then(() => {
                        alert('App link copied to clipboard!');
                    });
                } else {
                    alert(`Share this link: ${url}`);
                }
            }
        }
    </script>
</body>
</html>
